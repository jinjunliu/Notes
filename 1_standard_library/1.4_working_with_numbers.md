---
title: "Working with Numbers"
date: 2021-11-18T00:00:00-06:00
draft: false
weight: 24
---

本节讨论Python标准库对数(Numbers)的操作，比如生成随机数，随机序列，加密等等。

## 生成随机数

计算机使用伪随机数生成器(pseudo-random number generator, PRNG)来生成随机数。It uses random seed value to derive a random number, typically used for statistical purposes, not to be used for security purposes. CSPRNGs (cryptographic secure pseudo-random number generators) are cryptographically secure PRNGs. CSRNGs are intended to be used for password generation, key generation, and other cryptographic purposes.


Python使用random模块来生成随机数，例如生成一个随机数：

```python
import random
print(random.random())
```

实现一个抛硬币(coin toss)的程序：

```python
import random
for i in range(10):
    print(random.choice(['heads', 'tails']))
```

可以指定生成随机数的范围：

```python
import random
print(random.randint(1, 10)) # 生成1到10的随机整数
print(random.uniform(1, 10)) # 生成1到10的随机浮点数
print(random.randrange(1, 10, 2)) # 生成1到10的随机整数，不包括10, 并且step=2
```

使用`seed`参数可以指定生成随机数的种子，对于固定的种子值，生成的随机数是固定的，对于不同的种子值，生成的随机数是不同的。

```python
import random
random.seed(1)
print(random.random())
```

无论我跑上面的代码多少次，生成的随机数都是`0.13436424411240122`。这样指定种子值有时候是有用的，比如我们想重现一个结果，但这也是为什么PRNG不能用于安全目的的原因。

## 随机序列

使用`choice`函数可以从一个序列中随机选择一个元素，例如：

```python
moves = ['rock', 'paper', 'scissors']
print(random.choice(moves))
```

输出结果是三个元素中的随机一个，比如`'rock'`。Python 3.6开始可以用`choices`（注意多了一个s）选择多个元素，并能用weights来指定元素的概率，例如：

```python
weights = [1, 2, 3] # 每个元素的概率分别是1/6, 1/3, 1/2
print(random.choices(moves, weights, k=5)) # 随机选择5个元素
```

`choices`是有replacement的，也就是可能会重复选择。而`sample`函数可以从一个序列中随机选择一些元素，并且没有replacement，即不会重复选择，例如：

```python
print(random.sample(moves, 2))
```

`shuffle`函数可以将一个序列中的元素随机打乱，就像在扑克牌中洗牌一样，例如：

```python
random.shuffle(moves)
print(moves)
```

如果是immutable序列，即不可改变值的序列，可以首先使用`sample`再使用`shuffle`，例如：

```python
import string
result = random.sample(string.ascii_lowercase, k=len(string.ascii_lowercase))
random.shuffle(result)
print(result)
```

结果将是随机排列的ascill_lowercase字符串。

## 密码学随机数

从Python 3.6开始，有`secrets`模块提供了密码学随机数生成器，可以提供安全的随机数，例如生成密码、安全密钥等。`os`模块提供了`urandom`函数，可以从系统的`/dev/urandom`设备中读取随机数，是`secrets`模块的基础。下面的代码是用`os`模块的`urandom`函数生成16字节的随机数：

```python
import os
result = os.urandom(16)
print([hex(b) for b in result]) # 将随机数转换为16进制
```

一般来说我们不必使用`urandom`，因为`secrets`模块提供了一些更高级的随机数生成器，例如使用`secrets.choice`函数可以从一个序列中随机选择一个元素，例如：

```python
import secrets
print(secrets.choice(moves))
```

使用`secrets.token_bytes`函数可以生成一个指定长度的随机字节序列，例如：

```python
import secrets
print(secrets.token_bytes(16))
```

使用`secrets.token_hex`函数可以生成一个指定长度的随机十六进制字符串，例如：

```python
import secrets
print(secrets.token_hex(16))
```

使用`secrets.token_urlsafe`函数可以生成一个指定长度的随机URL安全字符串，例如：

```python
import secrets
print(secrets.token_urlsafe(16))
```

## 临时密码和URLs

To be continued...